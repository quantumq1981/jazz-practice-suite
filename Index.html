<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jazz Practice Suite - Complete Training System</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

```
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  color: #eee;
  min-height: 100vh;
  padding: 20px;
}

.app-header {
  text-align: center;
  padding: 30px 0;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 20px;
  margin-bottom: 30px;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

h1 {
  font-size: 3em;
  background: linear-gradient(135deg, #ff9800, #ff5722, #e91e63);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.subtitle {
  color: #90caf9;
  font-size: 1.2em;
  font-style: italic;
}

.nav-tabs {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.tab-btn {
  padding: 15px 30px;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid #444;
  border-radius: 10px;
  color: #fff;
  font-size: 1em;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  backdrop-filter: blur(5px);
}

.tab-btn:hover {
  background: rgba(102, 187, 106, 0.2);
  border-color: #66bb6a;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
}

.tab-btn.active {
  background: linear-gradient(135deg, #66bb6a, #43a047);
  border-color: #66bb6a;
  box-shadow: 0 5px 20px rgba(102, 187, 106, 0.5);
}

.tab-content {
  display: none;
  animation: fadeIn 0.5s;
}

.tab-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.section {
  background: rgba(0, 0, 0, 0.4);
  border: 2px solid #333;
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 25px;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.section-title {
  color: #ff9800;
  font-size: 1.8em;
  margin-bottom: 20px;
  border-bottom: 2px solid #ff9800;
  padding-bottom: 10px;
}

.controls {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  margin-bottom: 20px;
  align-items: center;
}

.btn {
  padding: 12px 24px;
  background: linear-gradient(135deg, #ff9800, #f57c00);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-size: 1em;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5);
}

.btn:active {
  transform: translateY(0);
}

.btn.secondary {
  background: linear-gradient(135deg, #42a5f5, #1976d2);
  box-shadow: 0 4px 15px rgba(66, 165, 245, 0.3);
}

.btn.secondary:hover {
  box-shadow: 0 6px 20px rgba(66, 165, 245, 0.5);
}

.select-input {
  padding: 10px 15px;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid #444;
  border-radius: 8px;
  color: #fff;
  font-size: 1em;
  cursor: pointer;
  transition: all 0.3s;
}

.select-input:hover, .select-input:focus {
  border-color: #ff9800;
  background: rgba(255, 255, 255, 0.15);
  outline: none;
}

.fretboard-container {
  background: #1a1a1a;
  border: 3px solid #444;
  border-radius: 12px;
  padding: 20px;
  overflow-x: auto;
}

.fretboard {
  display: table;
  border-collapse: collapse;
  margin: 0 auto;
}

.string-row {
  display: table-row;
}

.string-label {
  display: table-cell;
  width: 30px;
  font-weight: bold;
  text-align: center;
  color: #ff9800;
  padding: 5px;
}

.fret {
  display: table-cell;
  width: 55px;
  height: 45px;
  border: 1px solid #333;
  text-align: center;
  vertical-align: middle;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s;
  background: #0a0a0a;
}

.fret:hover {
  background: #2a2a2a;
  transform: scale(1.05);
}

.fret.highlighted {
  font-weight: bold;
  border: 2px solid #fff;
}

.fret.root {
  background: #66bb6a !important;
  color: #000 !important;
  font-weight: bold;
  box-shadow: 0 0 10px rgba(102, 187, 106, 0.5);
}

.fret.sub {
  background: #42a5f5;
  color: #000;
}

.fret.dom {
  background: #ef5350;
  color: #000;
}

.fret.alt {
  background: #ffee58;
  color: #000;
}

.fret-markers {
  display: flex;
  gap: 3px;
  margin-top: 10px;
  padding-left: 35px;
  justify-content: flex-start;
}

.fret-marker {
  width: 55px;
  height: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #666;
  font-weight: bold;
}

.fret-marker.marked {
  color: #ff9800;
  font-size: 16px;
}

.progression-display {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.chord-card {
  background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(42, 42, 42, 0.9));
  border: 2px solid #444;
  border-radius: 10px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.chord-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(102, 187, 106, 0.3), transparent);
  transition: left 0.5s;
}

.chord-card:hover::before {
  left: 100%;
}

.chord-card:hover {
  border-color: #66bb6a;
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(102, 187, 106, 0.3);
}

.chord-card.active {
  border-color: #66bb6a;
  background: linear-gradient(135deg, rgba(46, 78, 46, 0.9), rgba(42, 42, 42, 0.9));
  box-shadow: 0 0 25px rgba(102, 187, 106, 0.5);
}

.bar-number {
  font-size: 0.9em;
  color: #ff9800;
  font-weight: bold;
  margin-bottom: 5px;
}

.chord-name {
  font-size: 1.8em;
  font-weight: bold;
  color: #fff;
  margin-bottom: 10px;
}

.scale-tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.scale-tag {
  background: rgba(66, 165, 245, 0.2);
  border: 1px solid #42a5f5;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.85em;
  color: #90caf9;
  transition: all 0.2s;
  cursor: pointer;
}

.scale-tag:hover {
  background: rgba(102, 187, 106, 0.3);
  border-color: #66bb6a;
  color: #66bb6a;
  transform: scale(1.05);
}

.scale-library {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
}

.scale-category {
  background: rgba(42, 42, 42, 0.6);
  padding: 20px;
  border-radius: 10px;
  border: 1px solid #444;
}

.category-title {
  color: #66bb6a;
  font-size: 1.3em;
  margin-bottom: 15px;
  font-weight: bold;
  border-bottom: 2px solid #66bb6a;
  padding-bottom: 8px;
}

.scale-item {
  padding: 12px;
  margin: 8px 0;
  background: rgba(30, 30, 30, 0.8);
  border: 1px solid #444;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.scale-item:hover {
  background: rgba(46, 78, 46, 0.6);
  border-color: #66bb6a;
  transform: translateX(5px);
}

.scale-name {
  font-weight: bold;
  color: #fff;
  margin-bottom: 5px;
  font-size: 1.1em;
}

.scale-notes {
  font-size: 0.9em;
  color: #90caf9;
  font-family: 'Courier New', monospace;
}

.practice-session {
  background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(30, 30, 50, 0.9));
  border: 2px solid #ff9800;
  border-radius: 15px;
  padding: 30px;
  text-align: center;
}

.session-timer {
  font-size: 4em;
  color: #66bb6a;
  font-weight: bold;
  margin: 20px 0;
  font-family: 'Courier New', monospace;
  text-shadow: 0 0 20px rgba(102, 187, 106, 0.5);
}

.practice-controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
}

.timer-btn {
  padding: 15px 40px;
  font-size: 1.2em;
  background: linear-gradient(135deg, #66bb6a, #43a047);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 5px 20px rgba(102, 187, 106, 0.4);
}

.timer-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 30px rgba(102, 187, 106, 0.6);
}

.timer-btn.pause {
  background: linear-gradient(135deg, #ffa726, #f57c00);
}

.timer-btn.stop {
  background: linear-gradient(135deg, #ef5350, #e53935);
}

.progress-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.stat-card {
  background: linear-gradient(135deg, rgba(66, 165, 245, 0.2), rgba(33, 150, 243, 0.1));
  border: 2px solid #42a5f5;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(66, 165, 245, 0.4);
}

.stat-value {
  font-size: 2.5em;
  font-weight: bold;
  color: #90caf9;
  margin: 10px 0;
}

.stat-label {
  color: #ccc;
  font-size: 1em;
}

.ear-training-section {
  text-align: center;
  padding: 30px;
}

.note-buttons {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
  max-width: 800px;
  margin: 20px auto;
}

.note-btn {
  padding: 20px;
  background: linear-gradient(135deg, #42a5f5, #1e88e5);
  border: 2px solid #1976d2;
  border-radius: 10px;
  color: #fff;
  font-size: 1.2em;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s;
}

.note-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 20px rgba(66, 165, 245, 0.5);
}

.note-btn:active {
  transform: scale(0.95);
}

.feedback {
  margin-top: 20px;
  padding: 15px;
  border-radius: 10px;
  font-size: 1.2em;
  font-weight: bold;
  min-height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.feedback.correct {
  background: rgba(102, 187, 106, 0.3);
  border: 2px solid #66bb6a;
  color: #66bb6a;
}

.feedback.incorrect {
  background: rgba(239, 83, 80, 0.3);
  border: 2px solid #ef5350;
  color: #ef5350;
}

.legend {
  display: flex;
  justify-content: center;
  gap: 25px;
  flex-wrap: wrap;
  margin: 20px 0;
  padding: 15px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.95em;
}

.legend-box {
  width: 25px;
  height: 25px;
  border-radius: 4px;
  border: 2px solid #555;
}

.metronome-display {
  text-align: center;
  padding: 30px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 15px;
  margin: 20px 0;
}

.bpm-display {
  font-size: 5em;
  color: #ff9800;
  font-weight: bold;
  margin: 20px 0;
  font-family: 'Courier New', monospace;
}

.bpm-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin: 20px 0;
}

.bpm-slider {
  width: 300px;
  height: 8px;
  -webkit-appearance: none;
  background: linear-gradient(to right, #42a5f5, #ff9800, #ef5350);
  border-radius: 5px;
  outline: none;
}

.bpm-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 25px;
  height: 25px;
  background: #fff;
  cursor: pointer;
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.visual-metronome {
  width: 100px;
  height: 100px;
  margin: 20px auto;
  border-radius: 50%;
  background: #333;
  border: 4px solid #ff9800;
  transition: all 0.1s;
}

.visual-metronome.beat {
  background: #ff9800;
  box-shadow: 0 0 30px rgba(255, 152, 0, 0.8);
  transform: scale(1.1);
}

@media (max-width: 768px) {
  h1 {
    font-size: 2em;
  }

  .nav-tabs {
    flex-direction: column;
  }

  .tab-btn {
    width: 100%;
  }

  .note-buttons {
    grid-template-columns: repeat(4, 1fr);
  }

  .bpm-display {
    font-size: 3em;
  }
}
```

  </style>
</head>
<body>
  <div class="app-header">
    <h1>üé∑ Jazz Practice Suite üé∏</h1>
    <p class="subtitle">Your Complete Bebop Training System</p>
  </div>

  <div class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('progressions')">Bird Blues</button>
    <button class="tab-btn" onclick="switchTab('scales')">Scale Library</button>
    <button class="tab-btn" onclick="switchTab('fretboard')">Fretboard</button>
    <button class="tab-btn" onclick="switchTab('practice')">Practice Timer</button>
    <button class="tab-btn" onclick="switchTab('ear')">Ear Training</button>
    <button class="tab-btn" onclick="switchTab('metronome')">Metronome</button>
    <button class="tab-btn" onclick="switchTab('progress')">Progress</button>
  </div>

  <!-- Bird Blues Tab -->

  <div id="progressions" class="tab-content active">
    <div class="section">
      <h2 class="section-title">üéµ Bird Blues Progression Generator</h2>
      <div class="controls">
        <button class="btn" onclick="generateNewProgression()">Generate New Blues</button>
        <select id="bluesKey" class="select-input" onchange="regenerateProgression()">
          <option value="F">F</option>
          <option value="Bb">Bb</option>
          <option value="Eb">Eb</option>
          <option value="C">C</option>
          <option value="G">G</option>
          <option value="D">D</option>
          <option value="A">A</option>
        </select>
        <select id="bluesType" class="select-input">
          <option value="0">Classic Bebop Blues</option>
          <option value="1">Quick Change Blues</option>
          <option value="2">Bird Blues (Extended)</option>
          <option value="3">Blues with II-V Changes</option>
          <option value="4">Blues with Tritone Sub</option>
        </select>
        <button class="btn secondary" onclick="playProgressionAudio()">‚ñ∂ Play Progression</button>
      </div>
      <div id="progressionDisplay" class="progression-display"></div>
    </div>
  </div>

  <!-- Scale Library Tab -->

  <div id="scales" class="tab-content">
    <div class="section">
      <h2 class="section-title">üìö Complete Scale Library</h2>
      <p style="text-align: center; color: #ccc; margin-bottom: 20px;">
        Click any scale to hear it and see it on the fretboard
      </p>
      <div id="scaleLibrary" class="scale-library"></div>
    </div>
  </div>

  <!-- Fretboard Tab -->

  <div id="fretboard" class="tab-content">
    <div class="section">
      <h2 class="section-title" id="fretboardTitle">üé∏ Interactive Fretboard</h2>
      <div class="legend">
        <div class="legend-item">
          <div class="legend-box" style="background: #66bb6a;"></div>
          <span>Root (1)</span>
        </div>
        <div class="legend-item">
          <div class="legend-box" style="background: #42a5f5;"></div>
          <span>Subdominant (2, 4, 6)</span>
        </div>
        <div class="legend-item">
          <div class="legend-box" style="background: #ef5350;"></div>
          <span>Dominant (5, 7)</span>
        </div>
        <div class="legend-item">
          <div class="legend-box" style="background: #ffee58;"></div>
          <span>Mediant (3)</span>
        </div>
      </div>
      <div class="fretboard-container">
        <div id="fretboardDisplay" class="fretboard"></div>
        <div class="fret-markers" id="fretMarkers"></div>
      </div>
    </div>
  </div>

  <!-- Practice Timer Tab -->

  <div id="practice" class="tab-content">
    <div class="section practice-session">
      <h2 class="section-title">‚è±Ô∏è Practice Session Timer</h2>
      <div class="session-timer" id="sessionTimer">00:00</div>
      <div class="practice-controls">
        <button class="timer-btn" onclick="startPracticeTimer()">Start</button>
        <button class="timer-btn pause" onclick="pausePracticeTimer()">Pause</button>
        <button class="timer-btn stop" onclick="stopPracticeTimer()">Stop</button>
      </div>
      <div class="controls">
        <label style="color: #ccc;">Session Goal (minutes):</label>
        <select id="practiceGoal" class="select-input">
          <option value="5">5 minutes</option>
          <option value="10">10 minutes</option>
          <option value="15">15 minutes</option>
          <option value="20">20 minutes</option>
          <option value="30" selected>30 minutes</option>
          <option value="45">45 minutes</option>
          <option value="60">60 minutes</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Ear Training Tab -->

  <div id="ear" class="tab-content">
    <div class="section ear-training-section">
      <h2 class="section-title">üëÇ Interval Ear Training</h2>
      <p style="color: #ccc; margin-bottom: 20px;">
        Listen to the interval and identify it
      </p>
      <button class="btn" onclick="playRandomInterval()">Play Random Interval</button>
      <div class="note-buttons" id="intervalButtons"></div>
      <div id="earFeedback" class="feedback"></div>
      <div style="margin-top: 20px; color: #ccc;">
        <p>Score: <span id="earScore" style="color: #66bb6a; font-weight: bold;">0</span> / <span id="earTotal">0</span></p>
      </div>
    </div>
  </div>

  <!-- Metronome Tab -->

  <div id="metronome" class="tab-content">
    <div class="section">
      <h2 class="section-title">ü•Å Interactive Metronome</h2>
      <div class="metronome-display">
        <div class="bpm-display" id="bpmDisplay">120</div>
        <div class="visual-metronome" id="visualMetronome"></div>
        <div class="bpm-controls">
          <button class="btn" onclick="changeBPM(-10)">-10</button>
          <button class="btn" onclick="changeBPM(-1)">-1</button>
          <input type="range" class="bpm-slider" id="bpmSlider" min="40" max="240" value="120" oninput="updateBPM(this.value)">
          <button class="btn" onclick="changeBPM(1)">+1</button>
          <button class="btn" onclick="changeBPM(10)">+10</button>
        </div>
        <div class="controls" style="justify-content: center;">
          <button class="btn" onclick="toggleMetronome()">‚ñ∂ Start</button>
          <select id="timeSignature" class="select-input">
            <option value="4">4/4</option>
            <option value="3">3/4</option>
            <option value="5">5/4</option>
            <option value="6">6/8</option>
            <option value="7">7/8</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Progress Tab -->

  <div id="progress" class="tab-content">
    <div class="section">
      <h2 class="section-title">üìä Your Progress</h2>
      <div class="progress-grid">
        <div class="stat-card">
          <div class="stat-label">Total Practice Time</div>
          <div class="stat-value" id="totalPracticeTime">0</div>
          <div class="stat-label">minutes</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Sessions Completed</div>
          <div class="stat-value" id="sessionsCompleted">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Scales Practiced</div>
          <div class="stat-value" id="scalesPracticed">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Current Streak</div>
          <div class="stat-value" id="currentStreak">0</div>
          <div class="stat-label">days</div>
        </div>
      </div>
      <div style="text-align: center; margin-top: 30px;">
        <button class="btn" onclick="resetProgress()">Reset All Progress</button>
      </div>
    </div>
  </div>

  <script>
    // Audio Context
    let audioContext = null;
    let currentOscillators = [];

    function initAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      return audioContext;
    }

    // Note frequencies
    const noteFrequencies = {
      'C': 261.63, 'C#': 277.18, 'Db': 277.18,
      'D': 293.66, 'D#': 311.13, 'Eb': 311.13,
      'E': 329.63,
      'F': 349.23, 'F#': 369.99, 'Gb': 369.99,
      'G': 392.00, 'G#': 415.30, 'Ab': 415.30,
      'A': 440.00, 'A#': 466.16, 'Bb': 466.16,
      'B': 493.88
    };

    // Music Theory Data
    const chromaticScale = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];
    const intervals = {
      'Unison': 0, 'Minor 2nd': 1, 'Major 2nd': 2, 'Minor 3rd': 3, 'Major 3rd': 4,
      'Perfect 4th': 5, 'Tritone': 6, 'Perfect 5th': 7, 'Minor 6th': 8,
      'Major 6th': 9, 'Minor 7th': 10, 'Major 7th': 11, 'Octave': 12
    };

    // Scale Library
    const scaleLibrary = {
      'Bebop Scales': [
        { name: 'Major Bebop', pattern: [0, 2, 4, 5, 7, 8, 9, 11] },
        { name: 'Dominant Bebop', pattern: [0, 2, 4, 5, 7, 9, 10, 11] },
        { name: 'Minor Bebop', pattern: [0, 2, 3, 4, 5, 7, 9, 10] },
        { name: 'Dorian Bebop', pattern: [0, 2, 3, 5, 7, 9, 10, 11] },
        { name: 'Melodic Minor Bebop', pattern: [0, 2, 3, 5, 7, 8, 9, 11] }
      ],
      'Diatonic Modes': [
        { name: 'Ionian (Major)', pattern: [0, 2, 4, 5, 7, 9, 11] },
        { name: 'Dorian', pattern: [0, 2, 3, 5, 7, 9, 10] },
        { name: 'Phrygian', pattern: [0, 1, 3, 5, 7, 8, 10] },
        { name: 'Lydian', pattern: [0, 2, 4, 6, 7, 9, 11] },
        { name: 'Mixolydian', pattern: [0, 2, 4, 5, 7, 9, 10] },
        { name: 'Aeolian (Natural Minor)', pattern: [0, 2, 3, 5, 7, 8, 10] },
        { name: 'Locrian', pattern: [0, 1, 3, 5, 6, 8, 10] }
      ],
      'Harmonic Minor Modes': [
        { name: 'Harmonic Minor', pattern: [0, 2, 3, 5, 7, 8, 11] },
        { name: 'Phrygian Dominant', pattern: [0, 1, 4, 5, 7, 8, 10] },
        { name: 'Altered Dominant bb7', pattern: [0, 1, 3, 4, 6, 8, 10] }
      ],
      'Jazz & Altered Scales': [
        { name: 'Altered Scale', pattern: [0, 1, 3, 4, 6, 8, 10] },
        { name: 'Whole Tone', pattern: [0, 2, 4, 6, 8, 10] },
        { name: 'Diminished (H-W)', pattern: [0, 1, 3, 4, 6, 7, 9, 10] },
        { name: 'Diminished (W-H)', pattern: [0, 2, 3, 5, 6, 8, 9, 11] },
        { name: 'Lydian Dominant', pattern: [0, 2, 4, 6, 7, 9, 10] },
        { name: 'Blues Scale', pattern: [0, 3, 5, 6, 7, 10] }
      ]
    };

    // Bird Blues Progressions
    const bluesProgressions = [
      {
        name: "Classic Bebop Blues",
        bars: [
          { num: "1-4", chord: "I7", scales: ["Dominant Bebop", "Major Bebop", "Blues Scale"] },
          { num: "5-6", chord: "IV7", scales: ["Dominant Bebop", "Mixolydian"] },
          { num: "7-8", chord: "I7", scales: ["Dominant Bebop", "Major Bebop"] },
          { num: "9", chord: "V7", scales: ["Dominant Bebop", "Mixolydian"] },
          { num: "10", chord: "IV7", scales: ["Dominant Bebop"] },
          { num: "11-12", chord: "I7 - V7", scales: ["Major Bebop", "Dominant Bebop"] }
        ]
      },
      {
        name: "Quick Change Blues",
        bars: [
          { num: "1-2", chord: "I7", scales: ["Dominant Bebop", "Major Bebop"] },
          { num: "3-4", chord: "IV7", scales: ["Dominant Bebop", "Mixolydian"] },
          { num: "5-6", chord: "I7", scales: ["Dominant Bebop"] },
          { num: "7-8", chord: "I7", scales: ["Major Bebop", "Blues Scale"] },
          { num: "9", chord: "V7", scales: ["Dominant Bebop"] },
          { num: "10", chord: "IV7", scales: ["Mixolydian"] },
          { num: "11-12", chord: "I7 - V7", scales: ["Dominant Bebop"] }
        ]
      },
      {
        name: "Bird Blues (Extended)",
        bars: [
          { num: "1-2", chord: "I‚ñ≥", scales: ["Major Bebop", "Ionian"] },
          { num: "3", chord: "IV7", scales: ["Dominant Bebop"] },
          { num: "4", chord: "iv7", scales: ["Dorian", "Minor Bebop"] },
          { num: "5-6", chord: "I‚ñ≥", scales: ["Major Bebop"] },
          { num: "7", chord: "vi7", scales: ["Dorian"] },
          { num: "8", chord: "II7", scales: ["Dominant Bebop", "Altered"] },
          { num: "9", chord: "ii7", scales: ["Dorian"] },
          { num: "10", chord: "V7", scales: ["Dominant Bebop", "Mixolydian"] },
          { num: "11", chord: "I‚ñ≥", scales: ["Major Bebop"] },
          { num: "12", chord: "II7", scales: ["Dominant Bebop"] }
        ]
      },
      {
        name: "Blues with II-V Changes",
        bars: [
          { num: "1-4", chord: "I7", scales: ["Dominant Bebop", "Major Bebop"] },
          { num: "5", chord: "ii7", scales: ["Dorian"] },
          { num: "6", chord: "V7", scales: ["Dominant Bebop"] },
          { num: "7-8", chord: "I7", scales: ["Major Bebop"] },
          { num: "9", chord: "ii7", scales: ["Dorian"] },
          { num: "10", chord: "V7", scales: ["Dominant Bebop", "Altered"] },
          { num: "11-12", chord: "I7 - V7", scales: ["Dominant Bebop"] }
        ]
      },
      {
        name: "Blues with Tritone Sub",
        bars: [
          { num: "1-4", chord: "I7", scales: ["Dominant Bebop"] },
          { num: "5-6", chord: "IV7", scales: ["Dominant Bebop", "Lydian Dominant"] },
          { num: "7-8", chord: "I7", scales: ["Major Bebop"] },
          { num: "9", chord: "bII7", scales: ["Lydian Dominant", "Whole Tone"] },
          { num: "10", chord: "IV7", scales: ["Dominant Bebop"] },
          { num: "11-12", chord: "I7 - bII7", scales: ["Dominant Bebop", "Altered"] }
        ]
      }
    ];

    // Transpose chord to key
    function transposeChord(chord, fromKey, toKey) {
      console.log('Transposing:', chord, 'from', fromKey, 'to', toKey);
      
      // Handle Roman numerals - convert to actual chord
      const romanToInterval = {
        'I': 0, 'bII': 1, 'II': 2, 'bIII': 3, 'III': 4, 'IV': 5,
        'bV': 6, 'V': 7, 'bVI': 8, 'VI': 9, 'bVII': 10, 'VII': 11,
        'i': 0, 'ii': 2, 'iii': 4, 'iv': 5, 'v': 7, 'vi': 9, 'vii': 11
      };
      
      // Extract the Roman numeral part
      let romanMatch = chord.match(/^(b?[IViv]+)/);
      
      if (romanMatch) {
        // It's a Roman numeral chord - convert to actual note
        const roman = romanMatch[1];
        const suffix = chord.substring(roman.length); // Get the 7, ‚ñ≥, etc.
        
        const interval = romanToInterval[roman];
        if (interval === undefined) {
          console.error('Unknown Roman numeral:', roman);
          return chord;
        }
        
        const toKeyIndex = chromaticScale.indexOf(toKey);
        const noteIndex = (toKeyIndex + interval) % 12;
        const note = chromaticScale[noteIndex];
        
        const result = note + suffix;
        console.log('Converted Roman numeral:', chord, '‚Üí', result);
        return result;
      }
      
      // It's already a letter-based chord - just transpose it
      const rootMatch = chord.match(/^[A-G][b#]?/);
      if (!rootMatch) {
        console.warn('Could not parse chord:', chord);
        return chord;
      }
      
      const fromIndex = chromaticScale.indexOf(fromKey);
      const toIndex = chromaticScale.indexOf(toKey);
      const shift = (toIndex - fromIndex + 12) % 12;
      
      const root = rootMatch[0];
      const rootIndex = chromaticScale.indexOf(root);
      const newRootIndex = (rootIndex + shift) % 12;
      const newRoot = chromaticScale[newRootIndex];
      
      return chord.replace(root, newRoot);
    }

    // Build scale from pattern
    function buildScale(root, pattern) {
      const rootIndex = chromaticScale.indexOf(root);
      return pattern.map(interval => {
        const noteIndex = (rootIndex + interval) % 12;
        return chromaticScale[noteIndex];
      });
    }

    // Play note
    function playNote(frequency, duration = 0.3, startTime = 0) {
      const ctx = initAudioContext();
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);
      
      oscillator.frequency.value = frequency;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0, ctx.currentTime + startTime);
      gainNode.gain.linearRampToValueAtTime(0.3, ctx.currentTime + startTime + 0.01);
      gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + startTime + duration);
      
      oscillator.start(ctx.currentTime + startTime);
      oscillator.stop(ctx.currentTime + startTime + duration);
      
      return oscillator;
    }

    // Play scale
    function playScale(notes, delay = 0.15) {
      notes.forEach((note, index) => {
        const freq = noteFrequencies[note] || 440;
        playNote(freq, 0.3, index * delay);
      });
    }

    // Generate progression
    let currentProgression = null;
    let currentKey = 'F';

    function generateNewProgression() {
      const typeSelect = document.getElementById('bluesType');
      const keySelect = document.getElementById('bluesKey');
      const progressionIndex = parseInt(typeSelect.value);
      currentKey = keySelect.value;
      
      console.log('Generating progression:', progressionIndex, 'in key:', currentKey);
      currentProgression = bluesProgressions[progressionIndex];
      console.log('Current progression:', currentProgression);
      displayProgression();
    }

    function regenerateProgression() {
      if (currentProgression) {
        currentKey = document.getElementById('bluesKey').value;
        console.log('Regenerating in key:', currentKey);
        displayProgression();
      }
    }

    function displayProgression() {
      const display = document.getElementById('progressionDisplay');
      if (!display) {
        console.error('progressionDisplay element not found!');
        return;
      }
      
      if (!currentProgression) {
        console.error('No current progression!');
        return;
      }
      
      console.log('Displaying progression with', currentProgression.bars.length, 'bars');
      display.innerHTML = '';
      
      currentProgression.bars.forEach((bar, index) => {
        const card = document.createElement('div');
        card.className = 'chord-card';
        card.innerHTML = `
          <div class="bar-number">Bars ${bar.num}</div>
          <div class="chord-name">${transposeChord(bar.chord, 'F', currentKey)}</div>
          <div class="scale-tags">
            ${bar.scales.map(scale => `<span class="scale-tag" onclick="playChordScale('${bar.chord}', '${scale}')">${scale}</span>`).join('')}
          </div>
        `;
        
        card.onclick = function(e) {
          if (!e.target.classList.contains('scale-tag')) {
            document.querySelectorAll('.chord-card').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            const transposedChord = transposeChord(bar.chord, 'F', currentKey);
            const rootMatch = transposedChord.match(/^[A-G][b#]?/);
            if (rootMatch) {
              const rootNote = rootMatch[0];
              highlightChordTones(rootNote, transposedChord);
            } else {
              console.error('Could not extract root from:', transposedChord);
            }
          }
        };
        
        display.appendChild(card);
      });
      
      console.log('Successfully displayed', display.children.length, 'chord cards');
    }

    function playChordScale(chord, scaleName) {
      const transposedChord = transposeChord(chord, 'F', currentKey);
      const rootMatch = transposedChord.match(/^[A-G][b#]?/);
      
      if (!rootMatch) {
        console.error('Could not extract root from:', transposedChord);
        return;
      }
      
      const rootNote = rootMatch[0];
      
      // Find scale pattern
      let pattern = null;
      for (const category in scaleLibrary) {
        const scale = scaleLibrary[category].find(s => s.name === scaleName);
        if (scale) {
          pattern = scale.pattern;
          break;
        }
      }
      
      if (pattern) {
        const notes = buildScale(rootNote, pattern);
        playScale(notes);
        showScaleOnFretboard(scaleName, notes, rootNote);
      } else {
        console.error('Could not find scale pattern for:', scaleName);
      }
    }

    function playProgressionAudio() {
      if (!currentProgression) {
        alert('Please generate a progression first!');
        return;
      }
      
      let currentTime = 0;
      const chordDuration = 2; // seconds per chord
      
      currentProgression.bars.forEach((bar, index) => {
        const transposedChord = transposeChord(bar.chord, 'F', currentKey);
        const rootMatch = transposedChord.match(/^[A-G][b#]?/);
        
        if (!rootMatch) {
          console.error('Could not extract root from:', transposedChord);
          return;
        }
        
        const rootNote = rootMatch[0];
        
        // Play root and fifth as a basic chord sound
        const chordPattern = [0, 7]; // Root and fifth
        const chordNotes = buildScale(rootNote, chordPattern);
        
        chordNotes.forEach(note => {
          const freq = noteFrequencies[note] || 440;
          playNote(freq, chordDuration * 0.9, currentTime);
        });
        
        currentTime += chordDuration;
      });
    }

    // Fretboard
    const strings = ['E', 'B', 'G', 'D', 'A', 'E'];
    const numFrets = 12;

    function buildFretboard() {
      const fretboard = document.getElementById('fretboardDisplay');
      fretboard.innerHTML = '';
      
      strings.forEach((stringNote, stringIndex) => {
        const row = document.createElement('div');
        row.className = 'string-row';
        
        const label = document.createElement('div');
        label.className = 'string-label';
        label.textContent = stringNote;
        row.appendChild(label);
        
        const stringStartIndex = chromaticScale.indexOf(stringNote);
        
        for (let fret = 0; fret <= numFrets; fret++) {
          const noteIndex = (stringStartIndex + fret) % 12;
          const note = chromaticScale[noteIndex];
          
          const fretCell = document.createElement('div');
          fretCell.className = 'fret';
          fretCell.textContent = note;
          fretCell.dataset.note = note;
          fretCell.dataset.fret = fret;
          
          fretCell.onclick = function() {
            const freq = noteFrequencies[note];
            playNote(freq, 0.5);
          };
          
          row.appendChild(fretCell);
        }
        
        fretboard.appendChild(row);
      });
      
      // Fret markers
      const markers = document.getElementById('fretMarkers');
      markers.innerHTML = '';
      const markerFrets = [3, 5, 7, 9, 12];
      
      for (let i = 0; i <= numFrets; i++) {
        const marker = document.createElement('div');
        marker.className = 'fret-marker';
        if (markerFrets.includes(i)) {
          marker.textContent = i === 12 ? '‚óè‚óè' : '‚óè';
          marker.classList.add('marked');
        }
        markers.appendChild(marker);
      }
    }

    function showScaleOnFretboard(scaleName, notes, root) {
      document.querySelectorAll('.fret').forEach(f => {
        f.classList.remove('highlighted', 'root', 'sub', 'dom', 'alt');
      });
      
      const degreeFunctions = {
        '1': 'root', '2': 'sub', 'b3': 'alt', '3': 'alt',
        '4': 'sub', 'b5': 'dom', '5': 'dom', '#5': 'dom',
        '6': 'sub', 'b7': 'dom', '7': 'dom'
      };
      
      document.querySelectorAll('.fret').forEach(fret => {
        const note = fret.dataset.note;
        if (notes.includes(note)) {
          const rootIndex = chromaticScale.indexOf(root);
          const noteIndex = chromaticScale.indexOf(note);
          const interval = (noteIndex - rootIndex + 12) % 12;
          
          const degreeMap = { 0: '1', 1: 'b2', 2: '2', 3: 'b3', 4: '3', 5: '4', 6: 'b5', 7: '5', 8: '#5', 9: '6', 10: 'b7', 11: '7' };
          const degree = degreeMap[interval];
          const func = degreeFunctions[degree] || 'alt';
          
          fret.classList.add('highlighted', func);
          if (note === root) fret.classList.add('root');
        }
      });
      
      document.getElementById('fretboardTitle').textContent = `üé∏ ${scaleName} in ${root}`;
    }

    function highlightChordTones(root, chordType) {
      // Basic chord tone highlighting
      const chordPatterns = {
        '7': [0, 4, 7, 10],
        '‚ñ≥': [0, 4, 7, 11],
        'm7': [0, 3, 7, 10],
        '‚àÖ': [0, 3, 6, 10]
      };
      
      let pattern = [0, 4, 7, 10]; // default to dominant 7
      for (const type in chordPatterns) {
        if (chordType.includes(type)) {
          pattern = chordPatterns[type];
          break;
        }
      }
      
      const notes = buildScale(root, pattern);
      showScaleOnFretboard(`${chordType} Chord Tones`, notes, root);
    }

    // Scale Library Display
    function displayScaleLibrary() {
      const library = document.getElementById('scaleLibrary');
      library.innerHTML = '';
      
      for (const category in scaleLibrary) {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'scale-category';
        
        const title = document.createElement('div');
        title.className = 'category-title';
        title.textContent = category;
        categoryDiv.appendChild(title);
        
        scaleLibrary[category].forEach(scale => {
          const notes = buildScale('C', scale.pattern);
          const item = document.createElement('div');
          item.className = 'scale-item';
          item.innerHTML = `
            <div class="scale-name">${scale.name}</div>
            <div class="scale-notes">${notes.join(' - ')}</div>
          `;
          
          item.onclick = function() {
            playScale(notes);
            showScaleOnFretboard(scale.name, notes, 'C');
            switchTab('fretboard');
          };
          
          categoryDiv.appendChild(item);
        });
        
        library.appendChild(categoryDiv);
      }
    }

    // Practice Timer
    let practiceTimer = null;
    let practiceSeconds = 0;
    let isPracticing = false;

    function startPracticeTimer() {
      if (!isPracticing) {
        isPracticing = true;
        practiceTimer = setInterval(() => {
          practiceSeconds++;
          updateTimerDisplay();
          
          const goal = parseInt(document.getElementById('practiceGoal').value) * 60;
          if (practiceSeconds >= goal) {
            stopPracticeTimer();
            alert('üéâ Practice session complete! Great work!');
            updateProgress('session');
          }
        }, 1000);
      }
    }

    function pausePracticeTimer() {
      if (isPracticing) {
        isPracticing = false;
        clearInterval(practiceTimer);
      }
    }

    function stopPracticeTimer() {
      isPracticing = false;
      clearInterval(practiceTimer);
      if (practiceSeconds > 0) {
        const minutes = Math.floor(practiceSeconds / 60);
        updateProgress('time', minutes);
      }
      practiceSeconds = 0;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(practiceSeconds / 60);
      const seconds = practiceSeconds % 60;
      document.getElementById('sessionTimer').textContent = 
        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Ear Training
    let currentInterval = null;
    let earScore = 0;
    let earTotal = 0;

    function setupEarTraining() {
      const buttons = document.getElementById('intervalButtons');
      buttons.innerHTML = '';
      
      for (const interval in intervals) {
        const btn = document.createElement('button');
        btn.className = 'note-btn';
        btn.textContent = interval;
        btn.onclick = () => checkInterval(interval);
        buttons.appendChild(btn);
      }
    }

    function playRandomInterval() {
      const intervalNames = Object.keys(intervals);
      currentInterval = intervalNames[Math.floor(Math.random() * intervalNames.length)];
      const semitones = intervals[currentInterval];
      
      const baseFreq = 440;
      playNote(baseFreq, 0.4);
      setTimeout(() => {
        playNote(baseFreq * Math.pow(2, semitones / 12), 0.4);
      }, 500);
      
      document.getElementById('earFeedback').textContent = 'Listening...';
      document.getElementById('earFeedback').className = 'feedback';
    }

    function checkInterval(guess) {
      if (!currentInterval) {
        alert('Please play an interval first!');
        return;
      }
      
      earTotal++;
      const feedback = document.getElementById('earFeedback');
      
      if (guess === currentInterval) {
        earScore++;
        feedback.textContent = `‚úì Correct! It was a ${currentInterval}`;
        feedback.className = 'feedback correct';
      } else {
        feedback.textContent = `‚úó Incorrect. It was a ${currentInterval}`;
        feedback.className = 'feedback incorrect';
      }
      
      document.getElementById('earScore').textContent = earScore;
      document.getElementById('earTotal').textContent = earTotal;
      
      currentInterval = null;
    }

    // Metronome
    let metronomeInterval = null;
    let currentBeat = 0;
    let bpm = 120;
    let isMetronomeRunning = false;

    function toggleMetronome() {
      if (isMetronomeRunning) {
        stopMetronome();
      } else {
        startMetronome();
      }
    }

    function startMetronome() {
      isMetronomeRunning = true;
      const timeSignature = parseInt(document.getElementById('timeSignature').value);
      const interval = (60 / bpm) * 1000;
      
      metronomeInterval = setInterval(() => {
        currentBeat = (currentBeat % timeSignature) + 1;
        
        const freq = currentBeat === 1 ? 880 : 440;
        playNote(freq, 0.1);
        
        const visual = document.getElementById('visualMetronome');
        visual.classList.add('beat');
        setTimeout(() => visual.classList.remove('beat'), 100);
      }, interval);
    }

    function stopMetronome() {
      isMetronomeRunning = false;
      clearInterval(metronomeInterval);
      currentBeat = 0;
    }

    function updateBPM(value) {
      bpm = parseInt(value);
      document.getElementById('bpmDisplay').textContent = bpm;
      
      if (isMetronomeRunning) {
        stopMetronome();
        startMetronome();
      }
    }

    function changeBPM(amount) {
      bpm = Math.max(40, Math.min(240, bpm + amount));
      document.getElementById('bpmSlider').value = bpm;
      updateBPM(bpm);
    }

    // Progress Tracking
    function loadProgress() {
      const progress = JSON.parse(localStorage.getItem('jazzPracticeProgress') || '{}');
      document.getElementById('totalPracticeTime').textContent = progress.totalTime || 0;
      document.getElementById('sessionsCompleted').textContent = progress.sessions || 0;
      document.getElementById('scalesPracticed').textContent = progress.scales || 0;
      document.getElementById('currentStreak').textContent = progress.streak || 0;
    }

    function updateProgress(type, value = 1) {
      const progress = JSON.parse(localStorage.getItem('jazzPracticeProgress') || '{}');
      
      if (type === 'time') {
        progress.totalTime = (progress.totalTime || 0) + value;
      } else if (type === 'session') {
        progress.sessions = (progress.sessions || 0) + 1;
        updateStreak(progress);
      } else if (type === 'scale') {
        progress.scales = (progress.scales || 0) + 1;
      }
      
      localStorage.setItem('jazzPracticeProgress', JSON.stringify(progress));
      loadProgress();
    }

    function updateStreak(progress) {
      const today = new Date().toDateString();
      const lastPractice = progress.lastPractice;
      
      if (lastPractice === today) {
        return;
      }
      
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (lastPractice === yesterday.toDateString()) {
        progress.streak = (progress.streak || 0) + 1;
      } else {
        progress.streak = 1;
      }
      
      progress.lastPractice = today;
    }

    function resetProgress() {
      if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
        localStorage.removeItem('jazzPracticeProgress');
        loadProgress();
      }
    }

    // Tab Switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      
      document.getElementById(tabName).classList.add('active');
      
      // Find and activate the correct button
      const buttons = document.querySelectorAll('.tab-btn');
      buttons.forEach(btn => {
        if (btn.textContent.toLowerCase().includes(tabName.toLowerCase()) || 
            (tabName === 'progressions' && btn.textContent.includes('Bird Blues'))) {
          btn.classList.add('active');
        }
      });
      
      if (tabName === 'scales') {
        updateProgress('scale');
      }
    }

    // Initialize
    window.onload = function() {
      buildFretboard();
      displayScaleLibrary();
      setupEarTraining();
      loadProgress();
      generateNewProgression();
    };
  </script>

</body>
</html>
